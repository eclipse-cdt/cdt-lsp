<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<!--
   Copyright (c) 2023 Contributors to the Eclipse Foundation.

   This program and the accompanying materials
   are made available under the terms of the Eclipse Public License 2.0
   which accompanies this distribution, and is available at
   https://www.eclipse.org/legal/epl-2.0/

   SPDX-License-Identifier: EPL-2.0
-->
<plugin>
   <extension
         point="org.eclipse.ui.preferencePages">
      <!-- FIXME: AF: Exract clangd-specific preferences -->
      <!-- FIXME: AF: Move commmon part to "org.eclipse.cdt.lsp[.editor]" -->
      <page
            category="org.eclipse.cdt.ui.preferences.CPluginPreferencePage"
            class="org.eclipse.cdt.lsp.internal.clangd.editor.preferences.LspEditorPreferencePage"
            id="org.eclipse.cdt.lsp.clangd.editor.preferences.general"
            name="Editor (LSP)">
      </page>
   </extension>
   <extension
         point="org.eclipse.ui.propertyPages">
      <!-- FIXME: AF: Move me to "org.eclipse.cdt.lsp[.editor]" -->
      <page
            category="org.eclipse.cdt.ui.newui.Page_head_general"
            class="org.eclipse.cdt.lsp.internal.clangd.editor.properties.LspEditorPropertiesPage"
            id="org.eclipse.cdt.lsp.editor.properties.general"
            name="Editor (LSP)">
         <filter
               name="projectNature"
               value="org.eclipse.cdt.core.cnature">
         </filter>
         <enabledWhen>
            <adapt
                  type="org.eclipse.core.resources.IProject">
            </adapt>
         </enabledWhen>
      </page>
   </extension>
   <extension
         point="org.eclipse.core.expressions.propertyTesters">
      <!-- FIXME: AF: Move me to "org.eclipse.cdt.lsp" -->
      <propertyTester
            class="org.eclipse.cdt.lsp.internal.clangd.editor.expressions.LspEditorPreferencesTester"
            id="org.eclipse.cdt.lsp.expressions.lsp.prefer"
            namespace="org.eclipse.cdt.lsp"
            properties="prefer"
            type="java.lang.Object">
      </propertyTester>
      <!-- FIXME: AF: Move me to "org.eclipse.cdt.lsp[.editor]" -->
      <propertyTester
            class="org.eclipse.cdt.lsp.internal.clangd.editor.expressions.LspEditorActiveTester"
            id="org.eclipse.cdt.lsp.editor.active"
            namespace="org.eclipse.cdt.lsp.editor"
            properties="active"
            type="java.lang.Object">
      </propertyTester>
   </extension>
   <extension
         point="org.eclipse.cdt.lsp.serverProvider">
      <server
            class="org.eclipse.cdt.lsp.internal.clangd.ClangdLanguageServerProvider"
            priority="low">
         <enabledWhen>
            <test
                  forcePluginActivation="true"
                  property="org.eclipse.cdt.lsp.prefer">
            </test>
         </enabledWhen>
      </server>
   </extension>

  <extension
         point="org.eclipse.ui.commands">
      <!-- FIXME: AF: Register "org.eclipse.cdt.lsp.clangd.editor.commands.category.extensions" -->
      <command
            id="org.eclipse.cdt.lsp.clangd.editor.commands.command.switchSourceHeader"
            name="%Commands.ToggleSourceAndHeader.name">
      </command>
   </extension>
   <extension
         point="org.eclipse.ui.bindings">
      <key
            commandId="org.eclipse.cdt.lsp.clangd.editor.commands.command.switchSourceHeader"
            contextId="org.eclipse.ui.genericeditor.genericEditorContext"
            schemeId="org.eclipse.ui.defaultAcceleratorConfiguration"
            sequence="M1+TAB">
      </key>
   </extension>
   <extension
         point="org.eclipse.ui.handlers">
      <handler
            class="org.eclipse.cdt.lsp.internal.clangd.editor.handlers.ToggleSourceAndHeaderCommandHandler"
            commandId="org.eclipse.cdt.lsp.clangd.editor.commands.command.switchSourceHeader">
         <activeWhen>
            	<with variable="activeEditor">
                <test
                      property="org.eclipse.cdt.lsp.editor.active">
                </test>
            	</with>
         </activeWhen>
      </handler>
   </extension>
   <extension
         point="org.eclipse.ui.menus">
      <menuContribution
            allPopups="false"
            locationURI="popup:org.eclipse.ui.popup.any?before=org.eclipse.lsp4e.openCallHierarchy">
         <command
               commandId="org.eclipse.cdt.lsp.clangd.editor.commands.command.switchSourceHeader"
               label="%PopupMenu.ToggleSourceAndHeader.label"
               style="push">
            <visibleWhen
                  checkEnabled="true">
            </visibleWhen>
         </command>
      </menuContribution>
   </extension>

</plugin>
